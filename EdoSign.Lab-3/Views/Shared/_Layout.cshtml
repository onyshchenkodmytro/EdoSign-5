@using Microsoft.AspNetCore.Identity
@using EdoSign.Lab_3.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var currentVersion = HttpContextAccessor.HttpContext?.Request.Cookies["ApiVersion"] ?? "1.0";
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
}

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <title>EdoSign Lab 3</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>

    <header>
        <nav style="display:flex; align-items:center; justify-content:space-between">

            <!-- Ліва частина меню -->
            <div>
                <a asp-controller="Home" asp-action="Index">Головна</a>
                <a asp-controller="Subroutines" asp-action="Upload">Завантаження</a>
                <a asp-controller="Subroutines" asp-action="SignFile">Підпис файлу</a>
                <a asp-controller="Subroutines" asp-action="VerifyFile">Перевірка підпису</a>

                <!-- ORM -->
                <a asp-controller="Clients" asp-action="Index">Клієнти</a>
                <a asp-controller="DocumentTypes" asp-action="Index">Типи документів</a>
                <a asp-controller="SignedDocuments" asp-action="Index">Документи</a>
                <a asp-controller="Search" asp-action="Index">Пошук</a>
            </div>

            <!-- ПЕРЕМИКАЧ API версій -->
            <div style="margin-right:20px;">
                <span>API версія: </span>

                <a class="btn btn-sm @(currentVersion == "1.0" ? "btn-primary" : "btn-outline-primary")"
                   asp-controller="Version"
                   asp-action="Set"
                   asp-route-v="1.0"
                   asp-route-returnUrl="@returnUrl">
                    V1
                </a>

                <a class="btn btn-sm @(currentVersion == "2.0" ? "btn-primary" : "btn-outline-primary")"
                   asp-controller="Version"
                   asp-action="Set"
                   asp-route-v="2.0"
                   asp-route-returnUrl="@returnUrl">
                    V2
                </a>
            </div>

            <!-- Правий блок: логін / логаут -->
            <div>
                @if (SignInManager.IsSignedIn(User))
                {
                    <a asp-controller="Account" asp-action="Profile">Профіль</a>
                    <a asp-controller="Account" asp-action="Logout">Вихід</a>
                }
                else
                {
                    <form asp-controller="Account" asp-action="ExternalLogin" method="post" style="display:inline;">
                        <input type="hidden" name="provider" value="oidc" />
                        <button type="submit" class="btn btn-outline-primary" style="margin-left:10px;">
                            Вхід
                        </button>
                    </form>

                    <form asp-controller="Account" asp-action="ExternalRegister" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-outline-success" style="margin-left:10px;">
                            Реєстрація
                        </button>
                    </form>
                }
            </div>

        </nav>
    </header>

    <main class="container">
        @RenderBody()
    </main>

    @RenderSection("Scripts", required: false)

</body>
</html>

