@inject IHttpContextAccessor Http

@{
    var v = Http.HttpContext?.Request.Cookies["ApiVersion"] ?? "1.0";
}

<h2>Клієнти (API v@(v))</h2>

<table class="table" id="clientsTable">
    <thead>
        <tr>
            <th>Id</th>
            <th>Назва</th>

            @* У v2 з’являється Email *@
            @if (v == "2.0")
            {
                <th>Email</th>
            }
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section Scripts {
    <script>
        async function loadClients() {
            const version = "@v";
            const response = await fetch(`/api/v${version}/Clients`);

            if (!response.ok) {
                console.error("Failed to load clients", response.status);
                return;
            }

            const data = await response.json();
            const tbody = document.querySelector("#clientsTable tbody");
            tbody.innerHTML = "";

            data.forEach(c => {
                const tr = document.createElement("tr");

                tr.innerHTML =
                    version === "2.0"
                        ? `<td>${c.id}</td><td>${c.name}</td><td>${c.email}</td>`
                        : `<td>${c.id}</td><td>${c.name}</td>`;

                tbody.appendChild(tr);
            });
        }

        document.addEventListener("DOMContentLoaded", loadClients);
    </script>
}

