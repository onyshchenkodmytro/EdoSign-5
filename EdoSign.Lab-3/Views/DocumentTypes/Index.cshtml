@inject IHttpContextAccessor Http

@{
    var v = Http.HttpContext?.Request.Cookies["ApiVersion"] ?? "1.0";
}

<h2>Типи документів (API v@(v))</h2>

<table class="table" id="docTypesTable">
    <thead>
        <tr>
            <th>Id</th>
            <th>Нвзва</th>
            @if (v == "2.0")
            {
                <th>Опис</th>
            }
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section Scripts {
    <script>
        async function loadDocumentTypes() {
            const version = "@v";
            const response = await fetch(`/api/v${version}/document-types`);

            if (!response.ok) {
                console.error("Failed to load document types");
                return;
            }

            const data = await response.json();
            const tbody = document.querySelector("#docTypesTable tbody");
            tbody.innerHTML = "";

            data.forEach(t => {
                const tr = document.createElement("tr");

                tr.innerHTML =
                    version === "2.0"
                        ? `<td>${t.id}</td><td>${t.name}</td><td>${t.description}</td>`
                        : `<td>${t.id}</td><td>${t.name}</td>`;

                tbody.appendChild(tr);
            });
        }

        document.addEventListener("DOMContentLoaded", loadDocumentTypes);
    </script>
}

